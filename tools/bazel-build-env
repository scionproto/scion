#!/bin/bash

# This script generates the build options for Bazel

# Although it is the traditional way of capturing the git version, it isn't so helpful because the
# value is held in bazel's context and isn't available until execution time; not analysis. As a
# result it canNOT be used to generate variable target names. This script doesn't run early enough
# to generate/update a file in-time for the load phase either.
#
# Instead, prefer loading "versioning.bzl", which is generated by tools/bazel just before executing
# the real bazel.

ROOTDIR=$(dirname "$0")/..

# When building inside a docker container GIT_VERSION is set by the creator of the container.
# When building locally, use the version reported by git.
VERSION=${GIT_VERSION:-$($ROOTDIR/tools/git-version)}

echo "STABLE_GIT_VERSION $VERSION"
