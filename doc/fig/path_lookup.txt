# Generate .png on https://sequencediagram.org/

title Path Lookup

participantgroup #lightgreen **Local ISD**
participant Client
participant sciond
participant Local PS
participant Core PS A
participant Core PS B
end
participantgroup #lightblue **Remote ISD**
participant Core PS Q
participant Core PS R
end

#note over Core PS A: Core AS A is a provider\nof the local AS
#note over Core PS B: Core AS B is **not** a provider\nof the local AS.

autoactivation on

activate Client
Client -> sciond: PathRequest (dstIA)
sciond -> Local PS: SegRequest (up)
sciond <-- Local PS: SegReply (up, [localIA->A]) 

sciond -> Local PS: SegRequest (core, A, B)
Local PS -> Core PS A: SegRequest (core, A, B)
Local PS <-- Core PS A: SegReply (core, [A->B])
sciond <-- Local PS: SegReply (core, [A->B])

sciond -> Local PS: SegRequest (down, A, dstIA)
Local PS -> Core PS A: SegRequest (down, A, dstIA)
Local PS <-- Core PS A: SegReply (core, [A->dstIA])
sciond <-- Local PS: SegReply (down, [A->dstIA])


sciond -> Local PS: SegRequest (down, B, dstIA)
Local PS -> Core PS B: SegRequest (down, B, dstIA)
Local PS <-- Core PS B: SegReply (core, [B->dstIA])
sciond <-- Local PS: SegReply (down, [B->dstIA])

note over sciond: combine segments
Client <-- sciond : PathReply

==Destination in remote ISD==

Client -> sciond: PathRequest (dstIA)
sciond -> Local PS: SegRequest (up)
sciond <-- Local PS: SegReply (up, [localIA->A]) 

sciond -> Local PS: SegRequest (core, A, (dstIA.I,*))
Local PS -> Core PS A: SegRequest (core, A, (dstIA.I,*))
Local PS <-- Core PS A: SegReply (core, [A->Q, A->R])
sciond <-- Local PS: SegReply (core, [A->Q, A->R])

sciond -> Local PS: SegRequest (down, Q, dstIA)
Local PS -> Core PS Q: SegRequest (down, Q, dstIA)
Local PS <-- Core PS Q: SegReply (core, [Q->dstIA])
sciond <-- Local PS: SegReply (down, [Q->dstIA])

sciond -> Local PS: SegRequest (down, R, dstIA)
Local PS -> Core PS R: SegRequest (down, R, dstIA)
Local PS <-- Core PS R: SegReply (core, [R->dstIA])
sciond <-- Local PS: SegReply (down, [R->dstIA])

note over sciond: combine segments
Client <-- sciond : PathReply
