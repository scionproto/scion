name: Verify the specified codebase

on:
  push: # run this workflow on every push
  pull_request: # run this workflow on every pull_request

jobs:
  setup-and-test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout the SCION repository
        uses: actions/checkout@v2
      - name: Verify the specified files
        uses: viperproject/gobra-action@main
        with:
          # Prefix used to resolve SCION packages
          module: 'github.com/scionproto/scion/'
          # Right now, we only consider the "path" package defined
          # in the following path. In the future, the idea is to drop
          # these options in the configuration and to let Gobra verify
          # only the annotated files.
          srcDirectory: 'pkg/slayers/path'
          packages: 'path'
          # Gobra only verifies files annotated with the header "// +gobra"
          headerOnly: '1'
          globalTimeout: 30m
          packageTimeout: 15m
          caching: '1'
      - name: Upload the cached results
        uses: actions/upload-artifact@v2
        with:
          name: cache
          path: ${{ runner.workspace }}/.gobra/cache.json
