#!/bin/sh

# In bazel, it is not 
# Their excuse is that the name would need to be known before analysis begins... Well, then; here
# you go. This is executed *before* the real bazel runs. Dear user: you can load(versioning.bzl)
# and use it to make target names.

ROOTDIR=$(dirname "$0")/..

# When building inside a docker container GIT_VERSION is set by the creator of the container.
# When building locally, use the version reported by git.
VERSION=${GIT_VERSION:-$($ROOTDIR/tools/git-version)}
VERSION_NO_V=$(echo $VERSION | sed -n 's/^v//p')

echo "# Generated by bazel-build-env. Do check explanation there." > $ROOTDIR/versioning.bzl
echo "STABLE_GIT_VERSION = \"$VERSION\"" >> $ROOTDIR/versioning.bzl
echo "STRIPPED_GIT_VERSION = \"$VERSION_NO_V\"" >> $ROOTDIR/versioning.bzl

$BAZEL_REAL $@


